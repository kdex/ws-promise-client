System.register(["./EventEmitter.js"],function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e){e.ws&&e.ws.close()}var o,i,s=function(){function e(e,t,n){for(var r=0;r<t.length;r++){var o=t[r],i=o.decorators,s=o.key;if(delete o.key,delete o.decorators,o.enumerable=o.enumerable||!1,o.configurable=!0,("value"in o||o.initializer)&&(o.writable=!0),i){for(var u=0;u<i.length;u++){var a=i[u];if("function"!=typeof a)throw new TypeError("The decorator for method "+o.key+" is of the invalid type "+typeof a);o=a(e,s,o)||o}if(void 0!==o.initializer){n[s]=o;continue}}Object.defineProperty(e,s,o)}}return function(t,n,r,o,i){return n&&e(t.prototype,n,o),r&&e(t,r,i),t}}(),u=function(e,t,n){for(var r=!0;r;){var o=e,i=t,s=n;u=c=a=void 0,r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var a=u.get;return void 0===a?void 0:a.call(s)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=s,r=!0}};return{setters:[function(e){o=e["default"]}],execute:function(){i=function(e){function o(e,n){t(this,o),u(Object.getPrototypeOf(o.prototype),"constructor",this).call(this),this.message=0,this.wsOptions={url:e,protocols:n}}return n(o,e),s(o,[{key:"open",decorators:[r],value:function(){return regeneratorRuntime.async(function(e){for(var t=this;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){t.ws=new WebSocket(t.wsOptions.url,t.wsOptions.protocols);for(var r=["close","error"],o=function(){var e=r[i],n="on"+e;t.ws[n]=function(){t[n]&&t[n].apply(t,arguments)}},i=0;i<r.length;i++)o();t.ws.onopen=function(t){e(t)},t.ws.onmessage=function(e){var n=e.data,r=JSON.parse(n);t.emit(r.message,r.body)}}));case 1:case"end":return e.stop()}},null,this)}},{key:"close",decorators:[r],value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},null,this)}},{key:"send",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?1e4:arguments[1];return new Promise(function(r,o){var i=JSON.stringify({message:t.message,body:JSON.stringify(e)}),s=setTimeout(function(){o(null)},n);t.addEventListener(t.message,function(e){clearTimeout(s),r(e)}),t.ws.send(i),t.message++})}}]),o}(o),e("Client",i),e("default",i)}}});